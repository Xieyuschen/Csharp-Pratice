# 关于依赖关系注入以及理解实例
依赖关系注入确实看文档有点抽象，我看了好多遍还看的迷迷糊糊的（我是废物，逃。但哪能咋办嘛，看不懂就多看几遍，主要是缺少实践经验导致文档里面介绍的很多东西我都搞不明白是个什么情况。。。
慢慢来吧，Machen langsam！
以下文档文段节选自微软的文档：  
`https://docs.microsoft.com/zh-cn/aspnet/core/fundamentals/dependency-injection?view=aspnetcore-3.1`  
## 依赖关系
1. 依赖项 是另一个对象所需的任何对象。  
这句话怎么理解呢？可以这样认为：  
一个`Person`对象，他想刷知乎，那么必须有一部手机。那么`Person`对象就依赖于手机对象。当然手机对象其实是一个泛型类，`IHandy`这样一个接口。各种各样的手机都继承自这个接口。  
那么，小明用手里的iPhone6来刷知乎，即`Person`对象依赖于iPhone6对象。

该类（`Person`）创建并直接依赖于iPhone6对象实例。码依赖关系（如前面的示例）存在问题，应该避免使用，原因如下：
2. 要用不同的实现替换 iPhone6，必须修改类。
 >比如说现在`Person`对象用的并不是iPhone6，想要换成Oppo，那么就必须把`Person`这个类修改了 
3. 如果 iPhone6 具有依赖关系，则必须由类对其进行配置。
>比如说手机要上网，上网这个功能依赖于`网卡`类，那么在`Person`这个类里面我就需要对`网卡`进行配置。
4. 在具有多个依赖于 iPhone6 的类的大型项目中，配置代码在整个应用中会变得分散。这种实现很难进行单元测试。 应用应使用模拟或存根 iPhone6 类，该类不能使用此方法。
> 一个单位里面的`Person`使用的`iPhone6`上网模式各不相同，有些wifi有些流量上网，那么配置网卡的代码就分布在每个`Person`的手机上，异常分散。 



## 依赖关系注入
1. 依赖关系注入通过以下方式解决了这些问题：使用接口或基类抽象化依赖关系实现。
> `Person`都有一个手机，使用接口`IHandy`，这样就解决了是什么手机的问题.苹果还是其他的都无所谓了，只要继承了`IHandy`接口就可以了。
2. 注册服务容器中的依赖关系。 ASP.NET Core 提供了一个**内置的服务容器** IServiceProvider。 服务已在应用的 Startup.ConfigureServices 方法中注册。
**将服务注入到使用它的类的构造函数中**。
> 这里说了一大堆，什么意思呢？  
——在`Person`这个类中的构造函数里会加入它需要的服务，比如这里需要一个手机，那么就在通过将内置服务容器里添加的服务注入到`Person`的构造函数里面去。

3.  框架负责创建依赖关系的实例，并在不再需要时对其进行处理。
> 就是说注入的时候已经是实例了，框架负责实例的管理（创建使用以及析构）。

4. 在注入自定义的服务时，可以使用方法`AddScoped(IServiceCollection,Object)`方法注册服务。